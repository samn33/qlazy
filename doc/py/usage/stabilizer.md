スタビライザー(Stabilizerクラス)
================================

## スタビライザーの操作

パウリ群の部分群S=<g_1,g_2,..,g_n>の要素g_iを作用させてもある状態が不
変になるとき、Sをスタビライザー群と言い、不変になる状態をスタビライザー
状態と言います。通常、状態の変化はヒルベルト空間上のベクトルに施される
ユニタリ変換'U |psi>'として表されますが、スタビライザーg_iに対するユニ
タリ変換'U g_i U+'で表すこともできます。Gottesmann-Knillの定理によると、
Uをクリフォード演算(X,Y,Z,H,S,S+,CX,CY,CZ)に限定すれば、スタビライザー
による表現方法(スタビライザー形式)によって、量子状態の変化は古典計算機
で効率良くシミュレーションできます。

qlazyには、スタビライザーを作成してクリフォード演算による状態変化や測
定をシミュレートする機能があります。

### 生成・初期化　

Stabilizerクラスがスタビライザーを表します。使用例を以下に示します。

    from qlazypy import Stabilizer
    sb = Stabilizer(qubit_num=3)

これで量子ビット数3の状態を特定するためのスタビライザーsbを生成します。
show()メソッドでスタビライザーを確認することができます。

    sb.show()
    >>> g[0]:  III
    >>> g[1]:  III
    >>> g[3]:  III

3量子ビットの状態をユニークに決めるためにはスタビライザー演算子は量子
ビットと同じ数3つ必要になりますので、g[0],g[1],g[2]という3つの演算子
(生成元と呼ばれています)を用意しています。最初はすべてがI(恒等演算子)
に設定されていますので、これでは状態はユニークに決まりません。そのため、
まず初期生成元の設定が必要です。例えば、すべての量子ビットを|0>に初期
化するためには、生成元は各々、

    >>> g[0]:  ZII
    >>> g[1]:  IZI
    >>> g[2]:  IIZ

になっている必要があります。set_allメソッドを呼び出すことで、この状態
にすることができます。以下のようにします。

    sb.set_all('Z')
	sb.show()
    >>> g[0]:  ZII
    >>> g[1]:  IZI
    >>> g[2]:  IIZ

また、すべての量子ビットを|+>に初期化したい場合には、

    sb.set_all('X')
	sb.show()
    >>> g[0]:  XII
    >>> g[1]:  IXI
    >>> g[2]:  IIX

とします。初期演算子を任意に設定することもできます。set_pauli_opメソッ
ドを使います。例えば、

    sb.set_pauli_op(0, 0, 'X')
    sb.set_pauli_op(0, 1, 'X')
    sb.set_pauli_op(1, 1, 'Z')
    sb.set_pauli_op(1, 2, 'Z')
    sb.set_pauli_op(2, 0, 'X')
	sb.show()
    >>> g[0]:  XXI
    >>> g[1]:  IZZ
    >>> g[2]:  XII

とします。set_pauli_opの第1引数は生成元番号を表し、第2引数は量子ビット
番号を表し、第3引数は設定するパウリ演算子('X','Y','Z','I')を指定します。
また、各生成元に4つの符号(+1,-1,+i,-i)をつけることもできます。
set_pauli_facメソッドを使います。例えば、

    sb.set_pauli_fac(1, '-i')
	sb.show()
    >>> g[0]:  XXI
    >>> g[1]:-iIZZ
    >>> g[2]:  XII

とします。set_pauli_facの第1引数は生成元の番具で、第2引数は指定したい
符号(4つのうちのどれか)を文字列で指定します。

### ゲート演算

スタビライザーに対してゲート演算を実行することができます。ただし、クリ
フォード演算に限定されます。つまり、対応しているゲート演算は
X,Y,Z,H,S,S+,CX,CY,CZのみです。Tゲートや回転ゲートは非クリフォード演算
なので実行できません。書式はQStateクラスやDensOpクラスの場合と同様です。

    sb.h(0).cx(0,1)
    ...
	
という具合に実行します。

#### 量子ビット数の制限

制限はありません。メモリが許す限り量子ビット数を設定できます。

#### 量子ビット数と生成元の数が異なる場合

以下のようにスタビライザーを生成してゲート演算を実行することができます。
独立な生成元の個数が量子ビット数と同じであれば測定もできます（状態がユ
ニークに決まるので）。が、そうでない場合測定はできません（エラーを返し
ます）。

    sb = Stabilizer(gene_num=4, qubit_num=3)
    sb.set_all('Z')
    sb.h(0).cx(0,1).cx(0,2)
    ...

#### カスタム・ゲートの追加

基本的なゲートを組み合わせてユーザーが独自に作成したカスタム・ゲートを、
Stabilizerクラスのメソッドとして登録したい場合は、Stabilizerクラスのク
ラス・メソッド'add_method'を使います。

例えば、指定した３つの量子ビット番号に各々X,Y,Zゲートを演算する'foo'ゲー
トを登録したいとします。まず、その演算を以下のように関数定義します。引
数'self'は、DensOpのインスタンスで、このselfに対してゲート演算を適用し
て、関数の最後でselfをリターンするようにします。

    def foo(self,q0,q1,q2):
        self.x(q0).y(q1).z(q2)
        return self

これをメソッドとして登録するには、以下のようにします。

    Stabilizer.add_method(foo)

'foo'を使用する場合は、

    sb.foo(0,1,2)

という具合に、通常のゲート演算と同様の書き方で実行できます。

また、複数のメソッドを同時に登録したい場合は、クラス・メソッ
ド'add_methods'を使って、以下のようにします。引数として設定できる関数
の数には特に制限はありません。

    Stabilizer.add_methods(foo, bar, hoge)

### 測定

QStateクラスと同様にmメソッドで測定データ(MDataStabilizerクラス)を取得
して適当な変数に格納します。頻度や最後の測定結果はfrequencyプロパティ
(pythonのCounter形式)とlastプロパティ(文字列)で取得することができます。

    md = sb.m(qid=[0,1,2], shots=100)
    print(md.frequency)
    print(md.last)
    >>> Counter({'000':58,'111':42})
    >>> 111

### メモリ解放

量子状態インスタンスや密度演算子インスタンスと同様、スタビライザーを使っ
た作業がすべて終わったら、内部のメモリを解放する必要があります。

    sb.free()
	
複数のスタビライザーのインスタンスがある場合、クラス・メソッ
ド'free_all'で一気に解放することができます。

    Stabilizer.free_all(sb_0, sb_1, sb_2)

また、引数に指定するのはスタビライザーのリストやタプルであっても良いですし、
それらの入れ子でもOKです。例えば、

    sb_A = [sb_1, sb_2]
    Stabilizer.free_all(sb_0, sb_A)

    sb_B = [sb_3, [sb_4, sb_5]]
    Stabilizer.free_all(sb_B)

という指定の仕方でも大丈夫です。ただし、同じスタビライザーインスタンス
を２度以上解放するのはNGです。

    Stabilizer.free_all(sb_0, [sb_0, sb_1])
	
こうしてしまわないようにご注意を。

### 複製

スタビライザーを複製することができます。以下のようにcloneメソッドを呼
び出します。

    sb_clone = sb.clone()

### リセット

すでに生成済みのスタビライザーを破棄(free)することなく、再度初期化して
使いたい場合は、reset()メソッドを使います。

    sb.reset()

とすれば、すべての演算子を恒等演算子Iにリセットすることができます。

### スタビライザーの表示

Stabilizerクラスのshowメソッドを使います。使用例を以下に示します。

    sb.show()

例えば、以下のように各生成元に含まれるパウリ演算子が表示されます。

    g[0]:  XXI
    g[1]:-iIZZ
    g[2]:  XII
	
### 要素の取得

get_pauli_opメソッドget_pauli_facメソッドで取得できます。

    sb.show()
    >>> g[0]:  XXI
    >>> g[1]:-iIZZ
    >>> g[2]:  XII

    print(sb.get_pauli_op(1,2))
	>>> Z
    print(sb.get_pauli_fac(1))
	>>> (0-1j)
    

以上
